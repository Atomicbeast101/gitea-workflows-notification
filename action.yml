name: Report
description: Sends a Pushover notification to user based on status of pipeline run.

inputs:
  success:
    description: True/False if success run.
    required: true
  development:
    description: True/False if this is development environment.
    default: false
  built_pushed:
    description: True/False if image was built/pushed.
    default: true
  tested:
    description: True/False if image was tested by pipeline.
    default: false
  pushover_user:
    description: User key for Pushover notification system.
    required: true
  pushover_token:
    description: App token for Pushover notification system.
    required: true

runs:
  using: composite
  steps:
    - name: Get Meta
      id: meta
      run: |
        echo REPO_NAME=$(echo "${GITHUB_REPOSITORY##*/}") >> $GITHUB_OUTPUT
        echo DATE_RELEASE=$(echo "`date +'%Y.%m.%d'`") >> $GITHUB_OUTPUT

    - name: Pipeline Success
      if: inputs.success
      uses: umahmood/pushover-actions@main
      env:
        PUSHOVER_USER: ${{ inputs.pushover_user }}
        PUSHOVER_TOKEN: ${{ inputs.pushover_token }}
      with:
        title: Gitea DevOps
        message: ✅ ${{ inputs.built_pushed && 'Built/Pushed' }}${{ inputs.tested && "/Tested" }} ${{ steps.meta.outputs.REPO_NAME }}:${{ steps.meta.outputs.DATE_RELEASE }}${{ inputs.development && '-dev' || '' }} app!

    - name: Pipeline Failure
      if: ${{ !inputs.success }}
      uses: umahmood/pushover-actions@main
      env:
        PUSHOVER_USER: ${{ inputs.pushover_user }}
        PUSHOVER_TOKEN: ${{ inputs.pushover_token }}
      with:
        title: Gitea DevOps
        message: ❌ Unable to ${{ inputs.built_pushed && 'build/push' }}${{ inputs.tested && "/test" }} ${{ steps.meta.outputs.REPO_NAME }}:${{ steps.meta.outputs.DATE_RELEASE }}${{ inputs.development && '-dev' || '' }} app.
